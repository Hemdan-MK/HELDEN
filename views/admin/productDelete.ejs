<!DOCTYPE html>
<html lang="en">

<head>
<!-- Required meta tags -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Product Delete</title>
<!-- Layout styles -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="/admin/admin.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">

</head>

<body>
	<div class="sidebar">
        <div class="sidebar-brand">
            <span class="brand-full">H E L D E N</span>
            <span class="brand-short">H</span>
        </div>
        <ul class="nav flex-column mt-3">
            <li class="nav-item">
                <a class="nav-link" href="/admin/dashboard">
                    <i class="fas fa-th-large"></i>
                    <span>Dashboard</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/userManagement">
                    <i class="fas fa-users"></i>
                    <span>User Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link active" href="/admin/productManagement">
                    <i class="fas fa-box"></i>
                    <span>Product Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/orderManagement">
                    <i class="fas fa-shopping-cart"></i>
                    <span>Order Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/categoryManagement">
                    <i class="fas fa-folder"></i>
                    <span>Category Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link" href="/admin/couponManagement">
                    <i class="fas fa-ticket-alt"></i>
                    <span>Coupon Management</span>
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link " href="/admin/referralManagement">
                    <i class="fas fa-gift"></i>
                    <span>Referal Management</span>
                </a>
            </li>
            <li class="nav-item bottom">
                <a class="nav-link text-warning" href="/admin/logout">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Logout</span>
                </a>
            </li>
        </ul>
    </div>
	<div class="main-content">
		<!-- partial -->
		<div class="container-fluid page-body-wrapper">

			<!-- Category Form Section -->
			<div class="container mt-5">
				<h2>Soft Deleted Prooducts</h2>
				<table class="table-bordered mt-3">
					<thead>
						<tr>
							<th>Name</th>
							<th>Recover</th>
							<th>Permanent Delete</th>
						</tr>
					</thead>
					<tbody>
						<% deletedProducts.forEach(product=> { %>
						<tr>
							<td>
								<%= product.name %>
							</td>
							<td>
								<button type="submit" class="btn btn-success btn-recover" data-id="<%= product._id %>">Recover / List</button>
							</td>
							<td>
								<button type="submit" class="btn btn-danger btn-delete" data-id="<%= product._id %>">Permanent
									Delete</button>
							</td>
						</tr>
						<% }) %>
					</tbody>
				</table>
				<% if (deletedProducts.length===0) { %>
				<div class="w-100 h-50 d-flex justify-content-center">
					<h2 class="align-content-center">No Products in DATABASE</h2>
				</div>
				<% } %>
			</div>
		</div>
	</div>

	<!-- Script links -->
	<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@4.5.2/dist/js/bootstrap.bundle.min.js"></script>

	<script>
		document.querySelectorAll(".btn-recover").forEach(button => {
			button.addEventListener("click", async function(e) {
				const categoryId = this.getAttribute("data-id");
				const res = await fetch(`/admin/productManagement/recoverProducts/${categoryId}`, {
					method: 'PATCH',
					headers: {
						'Content-Type': 'application/json'
					}
				});
				let data = await res.json()

				if(data.success) {
					window.location.reload();
				} else {
					console.error("Failed to recover category");
				}
			});
		});

		document.querySelectorAll(".btn-delete").forEach(button => {
			button.addEventListener("click", async function() {
				const categoryId = this.getAttribute("data-id");
				const res = await fetch(`/admin/productManagement/permanentDeleteProducts/${categoryId}`, {
					method: 'DELETE',
					headers: {
						'Content-Type': 'application/json'
					}
				});

				let data = await res.json()

				if(data.success) {
					location.reload();
				} else {
					console.error("Failed to delete category");
				}
			});
		});
	</script>
</body>

</html>