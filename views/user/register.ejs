<!DOCTYPE html>
<html lang="en">

<head>
    <title>SignUp</title>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!--===============================================================================================-->
    <link rel="icon" type="image/png" href="/users/images/icons/favicon.png" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/bootstrap/css/bootstrap.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/fonts/font-awesome-4.7.0/css/font-awesome.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/fonts/iconic/css/material-design-iconic-font.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/fonts/linearicons-v1.0.0/icon-font.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/animate/animate.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/css-hamburgers/hamburgers.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/animsition/css/animsition.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/select2/select2.min.css" />
    <!--===============================================================================================-->
    <link rel="stylesheet" type="text/css" href="/users/vendor/perfect-scrollbar/perfect-scrollbar.css" />
    <!--===============================================================================================-->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet">
    <!-- Font Awsome CDN -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/sweetalert/2.1.2/sweetalert.min.js"></script>
    <!-- SweetAlert CDN -->
    <link rel="stylesheet" type="text/css" href="/users/css/util.css" />
    <link rel="stylesheet" href="/users/css/reg-log.css">
    <link rel="stylesheet" type="text/css" href="/users/css/main.css" />
    <!--===============================================================================================-->
    <style>
        /* Icons */
        .eye-icon {
            position: absolute;
            right: 5%;
            top: 75%;
            transform: translateY(-50%);
            cursor: pointer;
            color: #bbb;
            transition: color 0.3s ease;
        }

        .eye-icon:hover {
            color: #3d3d3d;
        }
    </style>
</head>

<body class="animsition">
    <!-- Header -->
    <%- include('./layout/header') %>

        <!-- Signup Container -->
        <div class="container up-container">
            <div class="row g-0 col-lg-12">
                <div class="col-lg-6 d-flex align-items-center">
                    <div class="up-form">
                        <h2 class="mb-4 text-center">R E G I S T E R</h2>
                        <form action="/register/sendOtp" id="reg-form" method="post">
                            <div id="error-message" class="text-danger mb-3"></div>
                            <div class="mb-3">
                                <label for="name" class="form-label">Username</label>
                                <input type="text" class="form-control" name="name" id="name"
                                    placeholder="Enter your username">
                            </div>
                            <div class="mb-3">
                                <label for="email" class="form-label">Email address</label>
                                <input type="email" class="form-control" name="email" id="email"
                                    placeholder="Enter email">
                            </div>
                            <div class="mb-3">
                                <label for="phno" class="form-label">Phone number</label>
                                <input type="number" class="form-control" name="phno" id="phno"
                                    placeholder="Enter phone number">
                            </div>
                            <div class="mb-3 pos-relative">
                                <label for="password" class="form-label">Password</label>
                                <input type="password" class="form-control" name="password" id="password"
                                    placeholder="Password">
                                <i class="fas fa-eye eye-icon toggleEye" onclick="toggleEye('password', this)"
                                    id="togglePassword"></i>
                            </div>
                            <div class="mb-3 pos-relative">
                                <label for="confirmPassword" class="form-label">Confirm Password</label>
                                <input type="password" class="form-control" name="confirmPassword" id="confirmPassword"
                                    placeholder="Confirm Password">
                                <i class="fas fa-eye eye-icon toggleEye" onclick="toggleEye('confirmPassword', this)"
                                    id="togglePassword"></i>
                            </div>
                            <div class="mb-3 form-check ml-4">
                                <input type="checkbox" class="form-check-input " id="terms">
                                <label class="form-check-label" for="terms">I agree to the terms & policies</label>
                            </div>
                            <button class="btn btn-dark w-100 btnSignup">Signup</button>
                        </form>
                        <hr>
                        <a href="/auth/google" class="btn btn-outline-dark w-100 mb-2"><i class="fab fa-google"></i>
                            Sign in with Google</a>
                        <p class="text-center mt-3">Have an account? <a href="/login">Sign in</a></p>
                    </div>
                </div>
                <div class="col-lg-6 background-image d-none d-lg-block"></div>
            </div>
        </div>




        <!-- Footer -->
        <%- include('./layout/footer') %>

            <!-- Back to top -->
            <div class="btn-back-to-top" id="myBtn">
                <span class="symbol-btn-back-to-top">
                    <i class="zmdi zmdi-chevron-up"></i>
                </span>
            </div>

            <script>
                function toggleEye(inputId, iconElement) {
                    // Get the password input field and icon
                    const passwordInput = document.getElementById(inputId);
                    const icon = iconElement;

                    // Toggle password visibility
                    if (passwordInput.type === "password") {
                        passwordInput.type = "text"; // Show password
                        icon.classList.remove("fa-eye");  // Change to eye open icon
                        icon.classList.add("fa-eye-slash");  // Change to eye slash icon
                    } else {
                        passwordInput.type = "password"; // Hide password
                        icon.classList.remove("fa-eye-slash");  // Change to eye open icon
                        icon.classList.add("fa-eye");  // Change to eye icon
                    }
                }



                document.querySelector('.btnSignup').addEventListener('click', formValidate)

                async function formValidate(e) {
                    e.preventDefault();

                    var name = document.getElementById('name').value.trim();
                    var email = document.getElementById('email').value.trim();
                    var phno = document.getElementById('phno').value.trim();
                    var password = document.getElementById('password').value.trim();
                    var confirmPassword = document.getElementById('confirmPassword').value.trim();
                    var termsChecked = document.getElementById('terms').checked;

                    // Validate each field
                    if (!validateName(name)) {
                        sweetAlert("Invalid Name", "Please enter a valid name.", "error");
                        return false;
                    }

                    if (!validateEmail(email)) {
                        sweetAlert("Invalid Email", "Please enter a valid email address.", "error");
                        return false;
                    }

                    if (!validatePhone(phno)) {
                        sweetAlert("Invalid Phone Number", "Please enter a valid phone number.", "error");
                        return false;
                    }

                    if (!validatePassword(password)) {
                        sweetAlert("Invalid Password", "Password must be at least 8 characters, include one uppercase letter, one number, and one special character.", "error");
                        return false;
                    }

                    if (password !== confirmPassword) {
                        sweetAlert("Password Mismatch", "Passwords do not match.", "error");
                        return false;
                    }

                    if (!termsChecked) {
                        sweetAlert("Terms Required", "You must agree to the terms and conditions.", "error");
                        return false;
                    }

                    // Check if user exists
                    const userExists = await checkUser(name, email, phno, password);
                    if (!userExists) {
                        sweetAlert("Email Exists", "This email is already registered. Please try with another email.", "error");
                        return false;
                    } else {
                        sweetAlert("Good job!", "Your OTP has been sent. Check your email!", "success");
                        window.location.href = "/register/loadOtp"
                        return true;
                    }
                }

                // Validate Name
                function validateName(name) {
                    return name.length >= 3; // Name should be at least 3 characters
                }

                // Validate Email
                function validateEmail(email) {
                    const regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                    return regex.test(email); // Check if email follows the standard pattern
                }

                // Validate Phone Number
                function validatePhone(phno) {
                    const regex = /^[0-9]{10}$/; // Validate 10-digit phone number
                    return regex.test(phno);
                }

                // Validate Password
                function validatePassword(password) {
                    const regex = /^(?=.*[A-Za-z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;
                    return regex.test(password); // Password must contain letters, numbers, and special characters
                }

                async function checkUser(name, email, phno, password) {
                    try {
                        const response = await fetch('/register/check-user', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({ name, email, phno, password })
                        });

                        const data = await response.json();
                        if (!data.success) {
                            return false; // User exists
                        } else {
                            return true; // User does not exist
                        }
                    } catch (error) {
                        console.error('Error checking user:', error);
                        return false; // Assume user does not exist if there's an error
                    }
                }
            </script>


            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/js/all.min.js"></script>

            <!--===============================================================================================-->
            <script src="/users/vendor/jquery/jquery-3.2.1.min.js"></script>
            <!--===============================================================================================-->
            <script src="/users/vendor/animsition/js/animsition.min.js"></script>
            <!--===============================================================================================-->
            <script src="/users/vendor/bootstrap/js/popper.js"></script>
            <script src="/users/vendor/bootstrap/js/bootstrap.min.js"></script>
            <!--===============================================================================================-->
            <script src="/users/vendor/select2/select2.min.js"></script>
            <script>
                $(".js-select2").each(function () {
                    $(this).select2({
                        minimumResultsForSearch: 20,
                        dropdownParent: $(this).next(".dropDownSelect2"),
                    });
                });
            </script>
            <!--===============================================================================================-->
            <script src="/users/vendor/MagnificPopup/jquery.magnific-popup.min.js"></script>
            <!--===============================================================================================-->
            <script src="/users/vendor/perfect-scrollbar/perfect-scrollbar.min.js"></script>
            <script>
                $(".js-pscroll").each(function () {
                    $(this).css("position", "relative");
                    $(this).css("overflow", "hidden");
                    var ps = new PerfectScrollbar(this, {
                        wheelSpeed: 1,
                        scrollingThreshold: 1000,
                        wheelPropagation: false,
                    });

                    $(window).on("resize", function () {
                        ps.update();
                    });
                });
            </script>
            <!--===============================================================================================-->
            <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAKFWBqlKAGCeS1rMVoaNlwyayu0e0YRes"></script>
            <script src="/users/js/map-custom.js"></script>
            <!--===============================================================================================-->
            <script src="/users/js/main.js"></script>
</body>

</html>